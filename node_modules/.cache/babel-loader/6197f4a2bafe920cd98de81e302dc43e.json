{"ast":null,"code":"import _classCallCheck from\"/home/josho/Dero/DERO_OAO/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/josho/Dero/DERO_OAO/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{nanoid}from'nanoid';var DeroBridgeApi=/*#__PURE__*/function(){function DeroBridgeApi(){_classCallCheck(this,DeroBridgeApi);this.channel=new MessageChannel();this.initialized=false;this.resolves=new Map();}_createClass(DeroBridgeApi,[{key:\"call\",value:function call(cmd){var _this=this;if(!this.initialized)return Promise.reject(new Error(\"Not initialized.\"));var id=nanoid();var msg={id:id,cmd:cmd};var promise=new Promise(function(resolve,reject){_this.channel.port1.addEventListener('message',function(event){if(event.data.id===id){var _event$data=event.data,err=_event$data.err,data=_event$data.data;if(data)resolve(data);else if(err)reject(err);else reject(new Error(\"Empty event.\"));}if(event.data==='disconnected'){_this.initialized=false;reject(event);}},{once:true});_this.channel.port1.start();});this.channel.port1.postMessage(msg);return promise;}},{key:\"daemon\",value:function daemon(action,args){return this.call({entity:'daemon',action:action,args:args});}},{key:\"wallet\",value:function wallet(action,args){return this.call({entity:'wallet',action:action,args:args});}},{key:\"init\",value:function init(){var _this2=this;if(this.initialized)return Promise.reject(new Error(\"Already initialized.\"));return new Promise(function(resolve,reject){var timeoutId=setTimeout(function(){if(!_this2.initialized)reject(new Error(\"Can't initialized.\"));},1000);_this2.channel.port1.addEventListener('message',function(event){if(event.data==='initialized'){_this2.initialized=true;resolve();}else{clearTimeout(timeoutId);reject(new Error(\"Can't initialized.\"));}},{once:true});_this2.channel.port1.start();window.postMessage('init-dero-bridge','*',[_this2.channel.port2]);});}}]);return DeroBridgeApi;}();export{DeroBridgeApi as default};","map":{"version":3,"names":["nanoid","DeroBridgeApi","channel","MessageChannel","initialized","resolves","Map","cmd","Promise","reject","Error","id","msg","promise","resolve","port1","addEventListener","event","data","err","once","start","postMessage","action","args","call","entity","timeoutId","setTimeout","clearTimeout","window","port2"],"sources":["/home/josho/Dero/DERO_OAO/src/api.js"],"sourcesContent":["import { nanoid } from 'nanoid'\n\nexport default class DeroBridgeApi {\n  constructor() {\n    this.channel = new MessageChannel()\n    this.initialized = false\n    this.resolves = new Map()\n  }\n\n  call(cmd) {\n    if (!this.initialized) return Promise.reject(new Error(`Not initialized.`))\n    const id = nanoid()\n    const msg = { id, cmd }\n    const promise = new Promise((resolve, reject) => {\n      this.channel.port1.addEventListener('message', (event) => {\n        if (event.data.id === id) {\n          const { err, data } = event.data\n          if (data) resolve(data)\n          else if (err) reject(err)\n          else reject(new Error(`Empty event.`))\n        }\n\n        if (event.data === 'disconnected') {\n          this.initialized = false\n          reject(event)\n        }\n      }, { once: true })\n\n      this.channel.port1.start()\n    })\n\n    this.channel.port1.postMessage(msg)\n    return promise\n  }\n\n  daemon(action, args) {\n    return this.call({ entity: 'daemon', action, args })\n  }\n\n  wallet(action, args) {\n    return this.call({ entity: 'wallet', action, args })\n  }\n\n  init() {\n    if (this.initialized) return Promise.reject(new Error(`Already initialized.`))\n\n    return new Promise((resolve, reject) => {\n      let timeoutId = setTimeout(() => {\n        if (!this.initialized) reject(new Error(`Can't initialized.`))\n      }, 1000)\n\n      this.channel.port1.addEventListener('message', (event) => {\n        if (event.data === 'initialized') {\n          this.initialized = true\n          resolve()\n        } else {\n          clearTimeout(timeoutId)\n          reject(new Error(`Can't initialized.`))\n        }\n      }, { once: true })\n\n      this.channel.port1.start()\n      window.postMessage('init-dero-bridge', '*', [this.channel.port2])\n    })\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}